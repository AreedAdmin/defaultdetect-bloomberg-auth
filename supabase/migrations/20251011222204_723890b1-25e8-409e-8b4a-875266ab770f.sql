-- Phase 2: Create persistent staging table for CSV imports
CREATE TABLE IF NOT EXISTS public.loan_staging (
  SK_ID_CURR BIGINT,
  TARGET INTEGER,
  NAME_CONTRACT_TYPE_x TEXT,
  CODE_GENDER TEXT,
  FLAG_OWN_CAR INTEGER,
  FLAG_OWN_REALTY INTEGER,
  CNT_CHILDREN INTEGER,
  AMT_INCOME_TOTAL NUMERIC,
  AMT_CREDIT_x NUMERIC,
  AMT_ANNUITY_x NUMERIC,
  AMT_GOODS_PRICE_x NUMERIC,
  NAME_TYPE_SUITE_x TEXT,
  NAME_INCOME_TYPE TEXT,
  NAME_EDUCATION_TYPE TEXT,
  NAME_FAMILY_STATUS TEXT,
  NAME_HOUSING_TYPE TEXT,
  REGION_POPULATION_RELATIVE INTEGER,
  DAYS_BIRTH INTEGER,
  DAYS_EMPLOYED INTEGER,
  DAYS_REGISTRATION INTEGER,
  DAYS_ID_PUBLISH INTEGER,
  FLAG_MOBIL INTEGER,
  FLAG_EMP_PHONE INTEGER,
  FLAG_WORK_PHONE INTEGER,
  FLAG_CONT_MOBILE INTEGER,
  FLAG_PHONE INTEGER,
  FLAG_EMAIL INTEGER,
  OCCUPATION_TYPE TEXT,
  CNT_FAM_MEMBERS INTEGER,
  REGION_RATING_CLIENT INTEGER,
  REGION_RATING_CLIENT_W_CITY INTEGER,
  WEEKDAY_APPR_PROCESS_START_x TEXT,
  HOUR_APPR_PROCESS_START_x INTEGER,
  REG_REGION_NOT_LIVE_REGION INTEGER,
  REG_REGION_NOT_WORK_REGION INTEGER,
  LIVE_REGION_NOT_WORK_REGION INTEGER,
  REG_CITY_NOT_LIVE_CITY INTEGER,
  REG_CITY_NOT_WORK_CITY INTEGER,
  LIVE_CITY_NOT_WORK_CITY INTEGER,
  ORGANIZATION_TYPE TEXT,
  EXT_SOURCE_2 NUMERIC,
  EXT_SOURCE_3 NUMERIC,
  OBS_30_CNT_SOCIAL_CIRCLE INTEGER,
  DEF_30_CNT_SOCIAL_CIRCLE INTEGER,
  OBS_60_CNT_SOCIAL_CIRCLE INTEGER,
  DEF_60_CNT_SOCIAL_CIRCLE INTEGER,
  DAYS_LAST_PHONE_CHANGE INTEGER,
  FLAG_DOCUMENT_2 INTEGER,
  FLAG_DOCUMENT_3 INTEGER,
  FLAG_DOCUMENT_4 INTEGER,
  FLAG_DOCUMENT_5 INTEGER,
  FLAG_DOCUMENT_6 INTEGER,
  FLAG_DOCUMENT_7 INTEGER,
  FLAG_DOCUMENT_8 INTEGER,
  FLAG_DOCUMENT_9 INTEGER,
  FLAG_DOCUMENT_10 INTEGER,
  FLAG_DOCUMENT_11 INTEGER,
  FLAG_DOCUMENT_12 INTEGER,
  FLAG_DOCUMENT_13 INTEGER,
  FLAG_DOCUMENT_14 INTEGER,
  FLAG_DOCUMENT_15 INTEGER,
  FLAG_DOCUMENT_16 INTEGER,
  FLAG_DOCUMENT_17 INTEGER,
  FLAG_DOCUMENT_18 INTEGER,
  FLAG_DOCUMENT_19 INTEGER,
  FLAG_DOCUMENT_20 INTEGER,
  FLAG_DOCUMENT_21 INTEGER,
  AMT_REQ_CREDIT_BUREAU_HOUR INTEGER,
  AMT_REQ_CREDIT_BUREAU_DAY INTEGER,
  AMT_REQ_CREDIT_BUREAU_WEEK INTEGER,
  AMT_REQ_CREDIT_BUREAU_MON INTEGER,
  AMT_REQ_CREDIT_BUREAU_QRT INTEGER,
  AMT_REQ_CREDIT_BUREAU_YEAR INTEGER,
  SK_ID_PREV BIGINT,
  NAME_CONTRACT_TYPE_y TEXT,
  AMT_ANNUITY_y NUMERIC,
  AMT_APPLICATION NUMERIC,
  AMT_CREDIT_y NUMERIC,
  AMT_GOODS_PRICE_y NUMERIC,
  WEEKDAY_APPR_PROCESS_START_y TEXT,
  HOUR_APPR_PROCESS_START_y INTEGER,
  FLAG_LAST_APPL_PER_CONTRACT INTEGER,
  NFLAG_LAST_APPL_IN_DAY INTEGER,
  NAME_CASH_LOAN_PURPOSE TEXT,
  NAME_CONTRACT_STATUS TEXT,
  DAYS_DECISION INTEGER,
  NAME_PAYMENT_TYPE TEXT,
  CODE_REJECT_REASON TEXT,
  NAME_CLIENT_TYPE TEXT,
  NAME_GOODS_CATEGORY TEXT,
  NAME_PORTFOLIO TEXT,
  NAME_PRODUCT_TYPE TEXT,
  CHANNEL_TYPE TEXT,
  SELLERPLACE_AREA NUMERIC,
  NAME_SELLER_INDUSTRY TEXT,
  CNT_PAYMENT INTEGER,
  NAME_YIELD_GROUP TEXT,
  PRODUCT_COMBINATION TEXT,
  DAYS_FIRST_DRAWING INTEGER,
  DAYS_FIRST_DUE INTEGER,
  DAYS_LAST_DUE_1ST_VERSION INTEGER,
  DAYS_LAST_DUE INTEGER,
  DAYS_TERMINATION INTEGER,
  NFLAG_INSURED_ON_APPROVAL INTEGER,
  community_id BIGINT,
  is_CashLoan INTEGER,
  OBS_30_CNT_SOCIAL_CIRCLE_missing INTEGER,
  DEF_30_CNT_SOCIAL_CIRCLE_missing INTEGER,
  OBS_60_CNT_SOCIAL_CIRCLE_missing INTEGER,
  DEF_60_CNT_SOCIAL_CIRCLE_missing INTEGER,
  AMT_REQ_CREDIT_BUREAU_HOUR_missing INTEGER,
  AMT_REQ_CREDIT_BUREAU_DAY_missing INTEGER,
  AMT_REQ_CREDIT_BUREAU_WEEK_missing INTEGER,
  AMT_REQ_CREDIT_BUREAU_MON_missing INTEGER,
  AMT_REQ_CREDIT_BUREAU_QRT_missing INTEGER,
  AMT_REQ_CREDIT_BUREAU_YEAR_missing INTEGER,
  DAYS_FIRST_DRAWING_missing INTEGER,
  DAYS_FIRST_DUE_missing INTEGER,
  DAYS_LAST_DUE_1ST_VERSION_missing INTEGER,
  DAYS_LAST_DUE_missing INTEGER,
  DAYS_TERMINATION_missing INTEGER,
  AMT_GOODS_PRICE_y_missing INTEGER,
  CNT_PAYMENT_missing INTEGER,
  AMT_ANNUITY_y_missing INTEGER,
  NFLAG_INSURED_ON_APPROVAL_missing INTEGER,
  EXT_SOURCE_2_missing INTEGER,
  EXT_SOURCE_3_missing INTEGER,
  AMT_GOODS_PRICE_x_missing INTEGER,
  AMT_ANNUITY_x_missing INTEGER,
  CREDIT_INCOME_RATIO NUMERIC,
  ANNUITY_INCOME_RATIO NUMERIC,
  CREDIT_GOODS_RATIO NUMERIC,
  INCOME_PER_PERSON NUMERIC,
  CHILDREN_RATIO NUMERIC,
  PAYMENT_RATE NUMERIC,
  AGE_YEARS NUMERIC,
  EMPLOYED_YEARS NUMERIC,
  REGISTRATION_YEARS_AGO NUMERIC,
  ID_PUBLISH_YEARS_AGO NUMERIC,
  PHONE_CHANGE_YEARS_AGO NUMERIC,
  EMPLOYMENT_TO_AGE_RATIO NUMERIC,
  NUM_ACTIVE_CONTACTS INTEGER,
  HAS_WORK_CONTACT INTEGER,
  HAS_ALL_DOCS INTEGER,
  STABILITY_SCORE INTEGER,
  URBAN_RURAL INTEGER,
  CITY_REGION_MISMATCH_SCORE INTEGER,
  BUREAU_QUERY_INTENSITY INTEGER,
  SHORT_TERM_BUREAU_RATIO NUMERIC,
  CREDIT_DIFF NUMERIC,
  ANNUITY_DIFF NUMERIC,
  GOODS_PRICE_DIFF NUMERIC,
  CREDIT_TO_GOODS_DELTA_RATIO NUMERIC,
  SAME_CONTRACT_TYPE INTEGER,
  SAME_WEEKDAY_APPR INTEGER,
  HOUR_APPR_DIFF INTEGER,
  CREDIT_DURATION_DAYS INTEGER,
  TIME_TO_FIRST_PAYMENT_DAYS INTEGER,
  TIME_TO_TERMINATION_DAYS INTEGER,
  OVERLAP_WITH_CURRENT INTEGER
);

-- Add comment explaining this table's purpose
COMMENT ON TABLE public.loan_staging IS 'Temporary staging table for bulk CSV imports. Data is transformed and moved to loan_applications table.';